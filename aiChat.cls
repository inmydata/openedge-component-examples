 
 /*------------------------------------------------------------------------
    File        : aiChat
    Purpose     : Displays the copilot interface with the ability to open related visualisations
    Syntax      : 
    Description : 
    Author(s)   : 
    Created     : Tue Jul 01 17:48:30 BST 2025
    Notes       : 
  ----------------------------------------------------------------------*/

USING Progress.Lang.*.
USING Progress.Windows.Form.

BLOCK-LEVEL ON ERROR UNDO, THROW.

CLASS aiChat INHERITS Form: 
    
    DEFINE PRIVATE VARIABLE analyticsControl AS inmydata.WindowsForms.Library.AnalyticsControl NO-UNDO.
    DEFINE PRIVATE VARIABLE components AS System.ComponentModel.IContainer NO-UNDO.

    /* --- Constructor ---
       Accepts a tenant name and sets up the AI chat experience
    */
    CONSTRUCTOR PUBLIC aiChat ( tenant AS CHARACTER ):
        
        InitializeComponent().
        analyticsControl:ContentType = inmydata.WindowsForms.Library.AnalyticsControl+ContentTypeEnum:AIChat.
        analyticsControl:tenant = tenant.
        THIS-OBJECT:ComponentsCollection:Add(THIS-OBJECT:components).
        CATCH e AS Progress.Lang.Error:
            UNDO, THROW e.
        END CATCH.

    END CONSTRUCTOR.

	/* --- Load Event Handler ---
       Called when the form loads. Loads the chat interface content.
    */
	@VisualDesigner.
	METHOD PRIVATE VOID aiChat_Load( INPUT sender AS System.Object, INPUT e AS System.EventArgs ):
		analyticsControl:LoadView().
		RETURN.

	END METHOD.

	/* --- AI Chat Charts Event Handler ---
       Triggered when the user clicks the Show Charts button generated by copilot.
       Iterates over returned chart IDs and opens each one in a new aiChatViz form.
    */
	@VisualDesigner.
	METHOD PRIVATE VOID analyticsControl_AIChatShowCharts( INPUT sender AS System.Object, INPUT e AS inmydata.WindowsForms.Library.AIChatShowChartEventArgs ):
		DEFINE VARIABLE ix AS INTEGER NO-UNDO.
		REPEAT ix = 1 TO e:AIChatChartIDs:Count:
		  DEFINE VARIABLE chartID AS CHARACTER.
		  chartID = e:AIChatChartIDs:Item[ix].
		  DEFINE VARIABLE aiChatViz AS aiChatViz.
		  aiChatViz = NEW aiChatViz(analyticsControl:Tenant, chartID).
		  aiChatViz:Show().    
		END.
		RETURN.

	END METHOD.

    METHOD PRIVATE VOID InitializeComponent(  ):
        
        /* NOTE: The following method is automatically generated.
        
        We strongly suggest that the contents of this method only be modified using the
        Visual Designer to avoid any incompatible modifications.
        
        Modifying the contents of this method using a code editor will invalidate any support for this file. */
        THIS-OBJECT:analyticsControl = NEW inmydata.WindowsForms.Library.AnalyticsControl().
        THIS-OBJECT:SuspendLayout().
        /*  */
        /* analyticsControl */
        /*  */
        THIS-OBJECT:analyticsControl:AIChatChartID = ?.
        THIS-OBJECT:analyticsControl:BackColor = System.Drawing.SystemColors:Control.
        THIS-OBJECT:analyticsControl:BackgroundColor = -2147483633.
        THIS-OBJECT:analyticsControl:ContentType = inmydata.WindowsForms.Library.AnalyticsControl+ContentTypeEnum:AIChat.
        THIS-OBJECT:analyticsControl:Dock = System.Windows.Forms.DockStyle:Fill.
        THIS-OBJECT:analyticsControl:ForeColor = System.Drawing.SystemColors:ControlText.
        THIS-OBJECT:analyticsControl:ForegroundColor = -2147483630.
        THIS-OBJECT:analyticsControl:ID = ?.
        THIS-OBJECT:analyticsControl:InsightChartID = ?.
        THIS-OBJECT:analyticsControl:Location = NEW System.Drawing.Point(0, 0).
        THIS-OBJECT:analyticsControl:Name = "analyticsControl".
        THIS-OBJECT:analyticsControl:Question = ?.
        THIS-OBJECT:analyticsControl:Server = "inmydata.com".
        THIS-OBJECT:analyticsControl:ShowToolbar = FALSE.
        THIS-OBJECT:analyticsControl:ShowTools = FALSE.
        THIS-OBJECT:analyticsControl:ShowToolToggle = FALSE.
        THIS-OBJECT:analyticsControl:Size = NEW System.Drawing.Size(617, 814).
        THIS-OBJECT:analyticsControl:Subject = ?.
        THIS-OBJECT:analyticsControl:SuppressDrilldown = FALSE.
        THIS-OBJECT:analyticsControl:TabIndex = 0.
        THIS-OBJECT:analyticsControl:Tenant = ?.
        THIS-OBJECT:analyticsControl:VisReadOnly = FALSE.
        THIS-OBJECT:analyticsControl:AIChatShowCharts:Subscribe(THIS-OBJECT:analyticsControl_AIChatShowCharts).
        /*  */
        /* aiChat */
        /*  */
        THIS-OBJECT:ClientSize = NEW System.Drawing.Size(617, 814).
        THIS-OBJECT:Controls:Add(THIS-OBJECT:analyticsControl).
        THIS-OBJECT:Name = "aiChat".
        THIS-OBJECT:Text = "aiChat".
        THIS-OBJECT:Load:Subscribe(THIS-OBJECT:aiChat_Load).
        THIS-OBJECT:ResumeLayout(FALSE).
        CATCH e AS Progress.Lang.Error:
            UNDO, THROW e.
        END CATCH.
    END METHOD.

    DESTRUCTOR PUBLIC aiChat ( ):

    END DESTRUCTOR.

END CLASS.